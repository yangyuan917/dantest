<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beautiful Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        .tabs {
            display: flex;
            background-color: #f4f4f4;
            padding: 10px;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 10px 0;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .tab:hover {
            background-color: #ddd;
        }

        .active {
            background-color: #444;
            color: white;
        }

        .grid {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
            gap: 20px;
        }
        .grid-item {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
            gap: 20px;
        }

        .item {
            flex: 1;
            min-width: calc(33.33% - 20px);
            background-color: #f4f4f4;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
        }

        .chart-radio-container {
        }

        img {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>

<body>
    <div id="app">
        <!-- <div id="chart0" style="width: 600px;height:400px;" class="item"></div> -->

        <div class="tabs">
            <div v-for="(tab, index) in tabs" :key="index" :class="{ 'tab': true, 'active': activeTab === index }" @click="changeTable(index)">{{ tab }}</div>
        </div>
        <div class="grid">
            <!-- <div v-for="(chartID, index1) in charts[activeTab]"  :key="index1" :id="chartID" style="width: 600px;height:400px;" class="item"></div> -->

            <div v-show="activeTab==0" class="grid-item">
                <div :id="chartID" v-for="(chartID,index) in charts[0]" :key="chartID" style="width: 600px;height:400px;" class="item"></div>
            </div>
            <div v-show="activeTab==1" class="grid-item">
                <div v-for="(chartID,index) in charts[1]" :key="chartID" v-show="activeTab==1" :id="chartID" style="width: 600px;height:400px;" class="item"></div>
            </div>
            <div v-show="activeTab==2" class="grid-item">
                <div v-for="(chartID,index) in charts[2]" :key="chartID" v-show="activeTab==2" :id="chartID" style="width: 600px;height:400px;" class="item">
                <div v-show="index==1" class="chart-radio-container">
                    <select id="selectTarget" @change="handleSelectChange">
                        <option value="600036.SH">600036.SH</option>
                        <option value="NDX.GI">NDX.GI</option>
                        <!-- 添加其他标的选项 -->
                    </select>
                    <select id="start_date" @change="handleSelectChange1; sendSelectedTarget">
                        <option value="2023-1-1">2023-1-1</option>
                        <option value="2023-3-1">2023-3-1</option>
                        <!-- 添加其他标的选项 -->
                    </select>
                    <p>{{ this.dy_downside }}</p>
                    <p>{{ "" }}</p>
                    <p>{{ dataList[dataList.length - 1] }}</p>
                </div>
                </div>
            </div>
            <!-- <div v-for="(chartID,index) in charts[2]" v-show="activeTab==2" :key="chartID">
                <div v-show="activeTab==2" :id="chartID" style="width: 600px;height:400px;" class="item"></div>

            </div> -->          
            <script src="https://unpkg.com/vue@3"></script>
            <script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/echarts@5.2.1/dist/echarts.min.js"></script>

            <script>
                // const url = "https://wmrisk-60067-10-1319347086.sh.run.tcloudbase.com"
                const url = 'http://localhost'
                const socket = io(url + ':8801');
                const app = Vue.createApp({
                    data() {
                        return {
                            tabs: ['总量-宏观利率', '总量-资金流向', '监测标的池'],
                            activeTab: 0,
                            charts: [
                                ['chart0', 'maro_rate', 'index_cnbd', 'm2', 'a', 'b'],
                                ['fund_flow_50', 'fund_flow_300', 'fund_flow_1000', 'new_fund_flow', 'north_flow', 'tmp'],
                                ['scores_short', 'f', 'fund_flow_300', 'h', 'g', 'g'],
                            ],
                            dy_downside: '',
                            message: '',
                            dataList: [],
                            start_date: '2023-1-1'

                        };
                    },
                    mounted() {
                        //这里初始化的时候就要获取数据，可以新增
                        socket.on('connected', data => {
                        this.message = data.message;
                        console.log('Connected')
                    });

                        socket.on('data2', data => {
                        console.log('data Connected')
                        this.dataList.push(data);
                        console.log(data);
                    });
                        this.getData()
                        this.getData0() //获取数据第一个数据
                        this.getData1() //获取数据第二个数据
                        this.getDataM2() //获取数据第二个数据
                        this.getData2() //获取数据第三个数据
                        this.getData_fundflow50()
                        this.getData_fundflow1000()
                        this.getData_new_fund_flow()
                        this.getData_north_flow()
                        selectedTarget = "600036.SH"
                        // start_date = '2023-1-1'
                        this.getData_scores_short(selectedTarget)
                        this.getData_scores_short1(selectedTarget, this.start_date)

                        // this.initEcharts('chart0');
                        // this.initEcharts('chart1');
                        // this.initEcharts('chart2');
                    },
                    methods: {
                        changeTable(index) {
                            this.activeTab = index;
                        },
                        handleSelectChange(event) {
                            const selectedTarget = event.target.value;
                            this.getData_scores_short(selectedTarget);
                            this.getData_scores_short1(selectedTarget, this.start_date);
                            console.log("getData_scores_short1: ", this.dy_downside);
                        },
                        handleSelectChange1(event) {
                            console.log("test-handleSelectChange1");
                            start_date = event.target.value;
                            this.start_date = event.target.value;
                            this.getData_scores_short1(selectedTarget, start_date);
                            console.log("getData_scores_short1: ", this.dy_downside);
                        },
                        sendSelectedTarget() {
                            // 当下拉选项变化时，将选中的值发送给后端
                            socket.emit('start_date', this.start_date);
                        },
                        async getData() { //获取对应的数据
                                fetch(url + ':8801/operation')
                                .then(response => {return response.json()})
                                .then(data => {
                                    console.log(Object.keys(data.data));
                                    const formattedData = Object.keys(data.data).map(key => {
                                        if (key === 'update_time'|| key == '发生日期') {
                                // 如果key等于'update_time'，直接返回null，跳过这个key
                                return null;
                                }
                                        ItemData = Object.keys(data.data[key]).map(key1 => { 
                                            const date = data.data.发生日期[key1];
                                            const value = data.data[key][key1];
                                            return {value: [new Date(date), value]}
                                        })
                                    return {name: key, type: 'bar', stack: 'stack', data: ItemData};
                                    }).filter(item => item !== null);
                                    console.log(data.data);
                                    console.log(formattedData);
                                    stime='2020-01-01';
                                    etime='2023-08-29';
                                    option = {
                                title: {
                                text: '标题',
                                },
                                tooltip: {
                                trigger: 'axis',
                                axisPointer: {
                                    type: 'shadow',
                                },
                                },
                                legend: {
                                data: Object.keys(data.data).sort()
                                },
                                grid: {
                                left: '3%',
                                right: '4%',
                                bottom: '3%',
                                containLabel: true,
                                },
                                xAxis: {
                                type: 'time',
                                //   min:'Thu, 02 Jan 2020 00:00:00 GMT',
                                //   max:"Tue, 01 Sep 2020 00:00:00 GMT",
                                min:new Date(stime.replace(/-/g,"/")),
                                max:new Date(etime.replace(/-/g,"/")),

                                },
                                dataZoom: [ // 添加数据区域缩放组件，即滚动条
                                {
                                show: true,
                                type: 'slider',
                                top: '90%',
                                bottom: '4%',
                                start: 95,
                                end: 100
                                }
                                ],
                                yAxis: {
                                type: 'value',
                                },
                                series: formattedData
                                };
                                    this.initEcharts('chart0', option) //请求后端数据后，初始化echarts
                                })
                        },
                        async getData0() { //获取对应的数据
                            fetch(url + ':8801/maro_rate')
                                .then(response => { return response.json() })
                                .then(data => {
                                    console.log("maro_rate:", Object.keys(data.data));
                                    const formattedData = Object.keys(data.data).map(key => {
                                        if (key === 'update_time' || key == 'trade_date' || key == '指标ID') {
                                            // 如果key等于'update_time'，直接返回null，跳过这个key
                                            return null;
                                        }
                                        ItemData = Object.keys(data.data[key]).map(key1 => {
                                            const date = data.data.指标ID[key1];
                                            const value = data.data[key][key1];
                                            return { value: [new Date(date), value] }
                                        })
                                        return { name: key, type: 'line', stack: 'Total', data: ItemData };
                                    }).filter(item => item !== null);
                                    console.log(data.data);
                                    console.log(formattedData);
                                    stime = '2023-01-01';
                                    let option = {
                                        title: {
                                            text: '利率变动'
                                        },
                                        tooltip: {
                                            trigger: 'axis'
                                        },
                                        grid: {
                                            left: '3%',
                                            right: '4%',
                                            bottom: '10%',
                                            containLabel: true
                                        },
                                        legend: {
                                            data: Object.keys(data.data).sort()
                                            },
                                        toolbox: {
                                            feature: {
                                                saveAsImage: {}
                                            }
                                        },
                                        dataZoom: [ // 添加数据区域缩放组件，即滚动条
                                            {
                                                show: true,
                                                type: 'slider',
                                                top: '90%',
                                                bottom: '4%',
                                                start: 90,
                                                end: 100
                                            }
                                        ],
                                        xAxis: {
                                            type: 'time',
                                            min: new Date(stime.replace(/-/g, "/")),
                                            // max:new Date(etime.replace(/-/g,"/")),
                                        },
                                        yAxis: {
                                            type: 'value'
                                        },
                                        series: formattedData
                                    };
                                    this.initEcharts('maro_rate', option) //请求后端数据后，初始化echarts
                                });
                        },
                        async getData1() { //获取对应的数据
                            fetch(url + ':8801/index_cnbd')
                                .then(response => { return response.json() })
                                .then(data => {
                                    console.log(Object.keys(data.data));
                                    const formattedData = Object.keys(data.data).map(key => {
                                        if (key === 'update_time' || key == 'trade_date' || key == '指标ID' || key == 'tag') {
                                            // 如果key等于'update_time'，直接返回null，跳过这个key
                                            return null;
                                        }
                                        ItemData = Object.keys(data.data[key]).map(key1 => {
                                            const date = data.data.指标ID[key1];
                                            const value = data.data[key][key1];
                                            return { value: [new Date(date), value] }
                                        })
                                        return { name: key, type: 'line', stack: 'Total', data: ItemData };
                                    }).filter(item => item !== null);
                                    console.log(data.data);
                                    console.log(formattedData);
                                    stime = '2023-01-01';
                                    // etime='2023-08-29';
                                    // 指定图表的配置项和数据
                                    let option = {
                                        title: {
                                            text: '固定/浮息强弱'
                                        },
                                        tooltip: {
                                            trigger: 'axis'
                                        },
                                        legend: {
                                        //   data: Object.keys(data.data).sort()
                                        data: ['a']
                                        },
                                        grid: {
                                            left: '3%',
                                            right: '4%',
                                            bottom: '10%',
                                            containLabel: true
                                        },
                                        toolbox: {
                                            feature: {
                                                saveAsImage: {}
                                            }
                                        },
                                        dataZoom: [ // 添加数据区域缩放组件，即滚动条
                                            {
                                                show: true,
                                                type: 'slider',
                                                top: '90%',
                                                bottom: '4%',
                                                start: 90,
                                                end: 100
                                            }
                                        ],
                                        xAxis: {
                                            type: 'time',
                                            min: new Date(stime.replace(/-/g, "/")),
                                            // max:new Date(etime.replace(/-/g,"/")),
                                        },
                                        yAxis: {
                                            type: 'value'
                                        },
                                        series: formattedData
                                    };

                                    // 使用刚指定的配置项和数据显示图表。
                                    this.initEcharts('index_cnbd', option) //请求后端数据后，初始化echarts

                                });
                        },
                        async getDataM2() { //获取对应的数据
                            fetch(url + ':8801/m2')
                                .then(response => { return response.json() })
                                .then(data => {
                                    console.log(Object.keys(data.data));
                                    const formattedData = Object.keys(data.data).map(key => {
                                        if (key === 'update_time' || key == 'trade_date' || key == '指标ID' || key == 'tag') {
                                            // 如果key等于'update_time'，直接返回null，跳过这个key
                                            return null;
                                        }
                                        ItemData = Object.keys(data.data[key]).map(key1 => {
                                            const date = data.data.指标ID[key1];
                                            const value = data.data[key][key1];
                                            return { value: [new Date(date), value] }
                                        })
                                        return { name: key, type: 'line', stack: 'Total', data: ItemData };
                                    }).filter(item => item !== null);
                                    console.log(data.data);
                                    console.log(formattedData);
                                    stime = '2023-01-01';
                                    // etime='2023-08-29';
                                    // 指定图表的配置项和数据
                                    let option = {
                                        title: {
                                            text: 'M2/社融'
                                        },
                                        tooltip: {
                                            trigger: 'axis'
                                        },
                                        legend: {
                                        //   data: Object.keys(data.data).sort()
                                        data: ['a']
                                        },
                                        grid: {
                                            left: '3%',
                                            right: '4%',
                                            bottom: '10%',
                                            containLabel: true
                                        },
                                        toolbox: {
                                            feature: {
                                                saveAsImage: {}
                                            }
                                        },
                                        dataZoom: [ // 添加数据区域缩放组件，即滚动条
                                            {
                                                show: true,
                                                type: 'slider',
                                                top: '90%',
                                                bottom: '4%',
                                                start: 0,
                                                end: 100
                                            }
                                        ],
                                        xAxis: {
                                            type: 'time',
                                            min: new Date(stime.replace(/-/g, "/")),
                                            // max:new Date(etime.replace(/-/g,"/")),
                                        },
                                        yAxis: {
                                            type: 'value'
                                        },
                                        series: formattedData
                                    };

                                    // 使用刚指定的配置项和数据显示图表。
                                    this.initEcharts('m2', option) //请求后端数据后，初始化echarts

                                });
                        },
                        async getData2() { //获取对应的数据
                            fetch(url + ':8801/fund_flow?tag=沪深300')
                                .then(response => { return response.json() })
                                .then(data => {
                                    console.log(Object.keys(data.data));
                                    const formattedData = Object.keys(data.data).map(key => {
                                        if (key === 'update_time' || key == 'trade_date' || key == 'tag') {
                                            // 如果key等于'update_time'，直接返回null，跳过这个key
                                            return null;
                                        }
                                        ItemData = Object.keys(data.data[key]).map(key1 => {
                                            const date = data.data.trade_date[key1];
                                            const value = data.data[key][key1];
                                            return { value: [new Date(date), value] }
                                        })
                                        return { name: key, type: 'bar', stack: 'stack', data: ItemData };
                                    }).filter(item => item !== null);
                                    console.log(data.data);
                                    console.log(formattedData);
                                    stime = '2020-01-01';
                                    etime = '2023-08-29';
                                    option = {
                                        title: {
                                            text: '沪深300',
                                        },
                                        tooltip: {
                                            trigger: 'axis',
                                            axisPointer: {
                                                type: 'shadow',
                                            },
                                        },
                                        legend: {
                                            data: Object.keys(data.data).sort()
                                        },
                                        grid: {
                                            left: '3%',
                                            right: '4%',
                                            bottom: '3%',
                                            containLabel: true,
                                        },
                                        xAxis: {
                                            type: 'time',
                                            //   min:'Thu, 02 Jan 2020 00:00:00 GMT',
                                            //   max:"Tue, 01 Sep 2020 00:00:00 GMT",
                                            min: new Date(stime.replace(/-/g, "/")),
                                            max: new Date(etime.replace(/-/g, "/")),

                                        },
                                        dataZoom: [ // 添加数据区域缩放组件，即滚动条
                                            {
                                                show: true,
                                                type: 'slider',
                                                top: '90%',
                                                bottom: '4%',
                                                start: 95,
                                                end: 100
                                            }
                                        ],
                                        yAxis: {
                                            type: 'value',
                                        },
                                        series: formattedData
                                    };

                                    // 使用刚指定的配置项和数据显示图表
                                    this.initEcharts('fund_flow_300', option) //请求后端数据后，初始化echarts

                                })
                        },
                        async getData_fundflow50() { //获取对应的数据
                            fetch(url + ':8801/fund_flow?tag=上证50')
                                .then(response => { return response.json() })
                                .then(data => {
                                    console.log(Object.keys(data.data));
                                    const formattedData = Object.keys(data.data).map(key => {
                                        if (key === 'update_time' || key == 'trade_date' || key == 'tag') {
                                            // 如果key等于'update_time'，直接返回null，跳过这个key
                                            return null;
                                        }
                                        ItemData = Object.keys(data.data[key]).map(key1 => {
                                            const date = data.data.trade_date[key1];
                                            const value = data.data[key][key1];
                                            return { value: [new Date(date), value] }
                                        })
                                        return { name: key, type: 'bar', stack: 'stack', data: ItemData };
                                    }).filter(item => item !== null);
                                    console.log(data.data);
                                    console.log(formattedData);
                                    stime = '2020-01-01';
                                    etime = '2023-08-29';
                                    option = {
                                        title: {
                                            text: '上证50',
                                        },
                                        tooltip: {
                                            trigger: 'axis',
                                            axisPointer: {
                                                type: 'shadow',
                                            },
                                        },
                                        legend: {
                                            data: Object.keys(data.data).sort()
                                        },
                                        grid: {
                                            left: '3%',
                                            right: '4%',
                                            bottom: '3%',
                                            containLabel: true,
                                        },
                                        xAxis: {
                                            type: 'time',
                                            //   min:'Thu, 02 Jan 2020 00:00:00 GMT',
                                            //   max:"Tue, 01 Sep 2020 00:00:00 GMT",
                                            min: new Date(stime.replace(/-/g, "/")),
                                            max: new Date(etime.replace(/-/g, "/")),

                                        },
                                        dataZoom: [ // 添加数据区域缩放组件，即滚动条
                                            {
                                                show: true,
                                                type: 'slider',
                                                top: '90%',
                                                bottom: '4%',
                                                start: 95,
                                                end: 100
                                            }
                                        ],
                                        yAxis: {
                                            type: 'value',
                                        },
                                        series: formattedData
                                    };

                                    // 使用刚指定的配置项和数据显示图表
                                    this.initEcharts('fund_flow_50', option) //请求后端数据后，初始化echarts

                                })
                        },
                        async getData_fundflow1000() { //获取对应的数据
                            fetch(url + ':8801/fund_flow?tag=中证1000')
                                .then(response => { return response.json() })
                                .then(data => {
                                    console.log(Object.keys(data.data));
                                    const formattedData = Object.keys(data.data).map(key => {
                                        if (key === 'update_time' || key == 'trade_date' || key == 'tag') {
                                            // 如果key等于'update_time'，直接返回null，跳过这个key
                                            return null;
                                        }
                                        ItemData = Object.keys(data.data[key]).map(key1 => {
                                            const date = data.data.trade_date[key1];
                                            const value = data.data[key][key1];
                                            return { value: [new Date(date), value] }
                                        })
                                        return { name: key, type: 'bar', stack: 'stack', data: ItemData };
                                    }).filter(item => item !== null);
                                    console.log(data.data);
                                    console.log(formattedData);
                                    stime = '2020-01-01';
                                    etime = '2023-08-29';
                                    option = {
                                        title: {
                                            text: '中证1000',
                                        },
                                        tooltip: {
                                            trigger: 'axis',
                                            axisPointer: {
                                                type: 'shadow',
                                            },
                                        },
                                        legend: {
                                            data: Object.keys(data.data).sort()
                                        },
                                        grid: {
                                            left: '3%',
                                            right: '4%',
                                            bottom: '3%',
                                            containLabel: true,
                                        },
                                        xAxis: {
                                            type: 'time',
                                            //   min:'Thu, 02 Jan 2020 00:00:00 GMT',
                                            //   max:"Tue, 01 Sep 2020 00:00:00 GMT",
                                            min: new Date(stime.replace(/-/g, "/")),
                                            max: new Date(etime.replace(/-/g, "/")),

                                        },
                                        dataZoom: [ // 添加数据区域缩放组件，即滚动条
                                            {
                                                show: true,
                                                type: 'slider',
                                                top: '90%',
                                                bottom: '4%',
                                                start: 95,
                                                end: 100
                                            }
                                        ],
                                        yAxis: {
                                            type: 'value',
                                        },
                                        series: formattedData
                                    };

                                    // 使用刚指定的配置项和数据显示图表
                                    this.initEcharts('fund_flow_1000', option) //请求后端数据后，初始化echarts

                                })
                        },
                        async getData_new_fund_flow() { //获取对应的数据
                            fetch(url + ':8801/new_fund_flow')
                                .then(response => { return response.json() })
                                .then(data => {
                                    console.log(Object.keys(data.data));
                                    const formattedData = Object.keys(data.data).map(key => {
                                        if (key === 'update_time' || key == '认购截止日期' || key == 'sale_rate') {
                                            // 如果key等于'update_time'，直接返回null，跳过这个key
                                            return null;
                                        }
                                        ItemData = Object.keys(data.data[key]).map(key1 => {
                                            const date = data.data.认购截止日期[key1];
                                            const value = data.data[key][key1];
                                            return { value: [new Date(date), value] }
                                        })
                                        return { name: key, type: 'bar', data: ItemData };
                                    }).filter(item => item !== null);
                                    console.log(data.data);
                                    console.log(formattedData);
                                    stime = '2020-01-01';
                                    etime = '2023-08-29';
                                    option = {
                                        title: {
                                            text: '新发基金',
                                        },
                                        tooltip: {
                                            trigger: 'axis',
                                            axisPointer: {
                                                type: 'shadow',
                                            },
                                        },
                                        legend: {
                                            data: Object.keys(data.data).sort()
                                        },
                                        grid: {
                                            left: '3%',
                                            right: '4%',
                                            bottom: '3%',
                                            containLabel: true,
                                        },
                                        xAxis: {
                                            type: 'time',
                                            //   min:'Thu, 02 Jan 2020 00:00:00 GMT',
                                            //   max:"Tue, 01 Sep 2020 00:00:00 GMT",
                                            min: new Date(stime.replace(/-/g, "/")),
                                            max: new Date(etime.replace(/-/g, "/")),

                                        },
                                        dataZoom: [ // 添加数据区域缩放组件，即滚动条
                                            {
                                                show: true,
                                                type: 'slider',
                                                top: '90%',
                                                bottom: '4%',
                                                start: 95,
                                                end: 100
                                            }
                                        ],
                                        yAxis: {
                                            type: 'value',
                                        },
                                        series: formattedData
                                    };

                                    // 使用刚指定的配置项和数据显示图表
                                    this.initEcharts('new_fund_flow', option) //请求后端数据后，初始化echarts

                                })
                        },
                        async getData_north_flow() { //获取对应的数据
                            fetch(url + ':8801/north_flow')
                                .then(response => { return response.json() })
                                .then(data => {
                                    console.log(Object.keys(data.data));
                                    const formattedData = Object.keys(data.data).map(key => {
                                        if (key === 'update_time' || key == 'trade_date' || key == 'sale_rate') {
                                            // 如果key等于'update_time'，直接返回null，跳过这个key
                                            return null;
                                        }
                                        ItemData = Object.keys(data.data[key]).map(key1 => {
                                            const date = data.data.trade_date[key1];
                                            const value = data.data[key][key1];
                                            return { value: [new Date(date), value] }
                                        })
                                        return { name: key, type: 'bar', data: ItemData };
                                    }).filter(item => item !== null);
                                    console.log(data.data);
                                    console.log(formattedData);
                                    stime = '2020-01-01';
                                    etime = '2023-08-29';
                                    option = {
                                        title: {
                                            text: '北向资金',
                                        },
                                        tooltip: {
                                            trigger: 'axis',
                                            axisPointer: {
                                                type: 'shadow',
                                            },
                                        },
                                        legend: {
                                            data: Object.keys(data.data).sort()
                                        },
                                        grid: {
                                            left: '3%',
                                            right: '4%',
                                            bottom: '3%',
                                            containLabel: true,
                                        },
                                        xAxis: {
                                            type: 'time',
                                            //   min:'Thu, 02 Jan 2020 00:00:00 GMT',
                                            //   max:"Tue, 01 Sep 2020 00:00:00 GMT",
                                            min: new Date(stime.replace(/-/g, "/")),
                                            max: new Date(etime.replace(/-/g, "/")),

                                        },
                                        dataZoom: [ // 添加数据区域缩放组件，即滚动条
                                            {
                                                show: true,
                                                type: 'slider',
                                                top: '90%',
                                                bottom: '4%',
                                                start: 95,
                                                end: 100
                                            }
                                        ],
                                        yAxis: {
                                            type: 'value',
                                        },
                                        series: formattedData
                                    };

                                    // 使用刚指定的配置项和数据显示图表
                                    this.initEcharts('north_flow', option) //请求后端数据后，初始化echarts

                                })
                        },
                        async getData_scores_short(selectedTarget) { //获取对应的数据
                            fetch(url + ':8801/scores_short?target=' + selectedTarget)
                                .then(response => { return response.json() })
                                .then(data => {
                                    console.log("scores_short: ", Object.keys(data.data));
                                    const formattedData = Object.keys(data.data).map(key => {
                                        if (key === 'update_time' || key == 'trade_date' || key == 'symbol') {
                                            // 如果key等于'update_time'，直接返回null，跳过这个key
                                            return null;
                                        }
                                        ItemData = Object.keys(data.data[key]).map(key1 => { 
                                        const date = data.data.trade_date[key1];
                                        const value = data.data[key][key1];
                                        return {value: [new Date(date), value]}
                                    })
                                return {name: key, type: 'line', stack: 'Total', symbolSize: 5, data: ItemData};
                                }).filter(item => item !== null);
                                console.log(data.data);
                                console.log(formattedData);
                                stime='2023-01-01';
                                // etime='2023-08-29';
                                // 指定图表的配置项和数据
                                option = {
                        title: {
                            text: '动态回撤'
                        },
                        tooltip: {
                            trigger: 'axis'
                        },
                        legend: {
                            data: ['dy_downside_2', 'dy_downside_5', 'dy_downside_20']
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '10%',
                            containLabel: true
                        },
                        toolbox: {
                            feature: {
                            saveAsImage: {}
                            }
                        },
                        dataZoom: [ // 添加数据区域缩放组件，即滚动条
                            {
                            show: true,
                            type: 'slider',
                            top: '90%',
                            bottom: '4%',
                            start: 90,
                            end: 100
                            }
                            ],
                        xAxis: {
                            type: 'time',
                            min:new Date(stime.replace(/-/g,"/")),
                            // max:new Date(etime.replace(/-/g,"/")),
                        },
                        yAxis: {
                            type: 'value'
                        },
                        series: formattedData
                        };     

                                    // 使用刚指定的配置项和数据显示图表
                                    this.initEcharts('scores_short', option) //请求后端数据后，初始化echarts

                                })
                        },
                        async getData_scores_short1(selectedTarget, start_date) { //获取对应的数据
                            fetch(url + ':8801/scores_short1?target=' + selectedTarget + '&start_date=' + start_date)
                                .then(response => { return response.json() })
                                .then(data => {
                                    console.log("scores_short: ", Object.keys(data.data));
                                    this.dy_downside = data.data
                                })
                        },                  
                        initEcharts(name, option) {//通用方法名-初始化echarts

                            let myChart = echarts.init(document.getElementById(name));
                            // let option =this.option[activeTab]
                            // 使用刚指定的配置项和数据显示图表
                            myChart.setOption(option, true);
                        }
                    },


                });

                app.mount('#app');
            </script>

</body>

</html>